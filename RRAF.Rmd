---
title: "Impact of Marine Protected Area's on California Spiny Lobster distribution along Santa Barbara coast"
subtitle: "A report prepared for ESM 206"
author: "Alicia Fennell and Rachel Rhodes"
date: "11/12/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
                      warning = FALSE)
```

# Introduction 

Starting in 2012, data has been collected on the abundance, size and location of the California spiny lobster (Panulirus interruptus) in an effort to understand the ecology of the coastal kelp forests along the Santa Barbara coast. California spiny lobsters are an important predator species thatkeep kelp-eating species like sea urchin in check. 


# Data and Methods

Santa Barbara Coastal Long Term Ecological Research program at UC Santa Barbaraca collected data for the abundance, size, and location of California spiny lobster along the coast of the Santa Barbara channel from 2012-2018. Spiny lobster abundance and size data was collected during annual dives before the start of the fishing season in late summer at five sites.Divers recorded the number and size of spiny lobster at four 60 x 5 m (300 m2 total) transects at each site. Two of the sites, Naples and Isla Vista, are Marine Protected Areas that were established in January 2012. Mean lobster abundance forMarine Protected area site and non-protected sites were compared by two-sample t-tests....All analysis and figured were prepared using R software version 3.6.1. 


```{r}

# Attach packages

library(tidyverse)
library(here)
library(janitor)
library(tidyr)
library(ggridges)
library(directlabels)
library(RColorBrewer)
library(effsize)
library(kableExtra)

```


```{r}

## Read in data and make it tidy

lobster_ab <- read_csv("lobster_abundance_sbc_lter.csv", na = "-99999") %>% 
  clean_names()

lobster_tidy <- lobster_ab %>% 
  uncount(count) %>% 
  mutate(site = replace(site, site == "IVEE", "Isla Vista")) %>%
  mutate(site = replace(site, site == "CARP", "Carpinteria")) %>% 
  mutate(site = replace(site, site == "AQUE", "Arroyo Quemado")) %>% 
  mutate(site = replace(site, site == "MOHK", "Mohawk")) %>% 
  mutate(site = replace(site, site == "NAPL", "Naples")) %>% 
  mutate(site_type = if_else(site %in% c("Isla Vista","Naples"), "MPA", "Non-MPA"))

## Make dataset for Results A to see abundance at differnent sites through the years

annual_ab_site <- lobster_tidy %>% 
  group_by(year) %>% 
  count(site) %>% 
  mutate(site_type = if_else(site %in% c("Isla Vista","Naples"), "MPA", "Non-MPA"))

 ## maybe delete this? Possibly incorrect summary table of mean sizes of MPA vs non-MPA sites in 2012 and 2018

lobster_summaries <- lobster_tidy %>% 
  filter(year == c(2012, 2018)) %>% 
  group_by(year, site_type) %>% 
  summarize(mean_size = mean(size_mm))

## Make a dataset for just 2012
  
year_2012 <- lobster_tidy %>% 
  filter(year == "2012")

## Make a dataset for just 2018

year_2018 <- lobster_tidy %>% 
  filter(year == "2018")
         
```


```{r}

## Exploratory graphs

# ggplot(annual_ab_site, aes(x = year, y = n)) +
#   geom_line(aes(color = site)) +
#   theme_minimal()
# 
# ggplot(annual_ab_site, aes(x = year, y = n)) +
#   geom_bar(stat = "identity") +
#   facet_wrap(~site) +
#   theme_minimal() 

```
## Results

#### 1. Effects of Marine Protected Area designation on spiny lobster abundance



```{r}

## Results A - visualalization showing  changes in annual lobster abundace at the five sites over time, designating MPA versus non-MPA sites. 

ggplot(annual_ab_site, aes(x = year, y = n)) +
  geom_line(aes(group = site,
                color = site_type), 
            size = 0.75) +
  scale_color_manual(values = c("coral2", "deepskyblue3"))+
  theme_minimal()+
  theme(
    legend.position = c(0.25, .88),
    legend.justification = c("right", "top"),
    legend.box.just = "right",
    legend.margin = margin(6, 6, 6, 6),
    legend.background = element_rect("white"))+
  xlim(2012,2019.5) +
  geom_dl(aes(label=site,
              color = site_type),
          method = "last.points") +
  ggtitle("CALIFORNIA SPINY LOBSTER ABUNDANCE",
          subtitle = "Santa Barbara Channel (2012 - 2018)")+
  labs(x = "Year",
       y = "Lobster count",
       color = "Site Type")
```


#### 2. Lobster size distribution shifts between 2012 and 2018

```{r}
## Data frame for exploring lobster size distribution shifts in 2012 and 2018

lobster_size <- lobster_tidy %>% 
  filter(year == c(2012, 2018)) %>% 
  mutate(site = fct_relevel(site, c("Isla Vista", "Naples", "Arroyo Quemado", "Carpinteria", "Mohak")))


```

```{r}
## Results B - Visualization of size distribution for lobsters obvserved at the 5 different sites in 2012 and 2018. Graph shows the community size distributions at each in the 2 years. 

ggplot(lobster_size, aes(x = site, y = size_mm, fill = factor(year))) +
  geom_violin()+
  stat_summary(fun.y = "mean", geom = "point", size = 3)+
  scale_fill_brewer()+
  labs(x = "Site",
       y = "Size (mm)",
       fill = "Year")+
  ggtitle("CALIFORNIA SPINY LOBSTER DISTRIBUTION 2012 & 2018",
          subtitle = "Santa Barbara Channel")+
  theme_minimal()+
  theme(legend.position = c(0.78, .88),
        legend.justification = c("left", "top"),
        legend.box.just = "right",
        legend.margin = margin(6, 6, 6, 6),
        legend.background = element_rect("white"))


```
```{r}

## Jitterplot not really working- unable to separate the two years the way we want

ggplot(lobster_size, aes(x = factor(year), y = size_mm)) +
  geom_jitter(aes(color = factor(year)), 
              alpha = 0.5)+
  geom_boxplot(width = 0.3)+
  facet_grid(~site) +
  labs(x = "Site",
       y = "Size (mm)",
       fill = "Year")+
  ggtitle("CALIFORNIA SPINY LOBSTER DISTRIBUTION 2012 & 2018",
          subtitle = "Santa Barbara Channel")+
  theme_minimal()
  # theme(legend.position = c(0.78, .88),
  #       legend.justification = c("left", "top"),
  #       legend.box.just = "right",
  #       legend.margin = margin(6, 6, 6, 6),
  #       legend.background = element_rect("white"))


```


#### 3. Mean lobster sizes between site types (MPA and non-MPA) in 2012 and 2018



## Summary

-----
```{r,}
## Starting t tests
## #1 size differences in 2012 between MPA and non-MPA

MPA_2012 <- year_2012 %>% 
  filter(site_type == "MPA") %>% 
  pull(size_mm)

non_MPA_2012 <- year_2012 %>% 
  filter(site_type == "Non-MPA") %>% 
  pull(size_mm)

size_2012_ttest <- t.test(MPA_2012, non_MPA_2012)

size_2012_ttest

#Cohen's d

size_2012_d <- effsize::cohen.d(MPA_2012, non_MPA_2012)

size_2012_d

## Summary tables

#### n_mpa_2012 <- come back to me! 

mean_MPA_2012 <- mean(MPA_2012, na.rm = TRUE)
sd_MPA_2012 <- sd(MPA_2012, na.rm = TRUE)

mean_nonMPA_2012 <- mean(non_MPA_2012, na.rm = TRUE)
sd_nonMPA_2012 <- sd(non_MPA_2012, na.rm = TRUE)



```

Is there a significant difference in lobster size between MPA and non-MPA sites in 2012? 

Mean lobster size (mm) in MPA sites (`r round(mean_MPA_2012, 2)` $\pm$ `r round(sd_MPA_2012, 2)`, n = (inline referencing for n) differed significantly from the mean lobster size in non-MPA sites (`r round(mean_nonMPA_2012, 2)`) $\pm$ `r round(sd_nonMPA_2012, 2)`, n = (inline referencing!!) by using a two-sample t-test (t(`r round(size_2012_ttest$parameter, 2)`) = `r round(size_2012_ttest$statistic, 2)`, *p* <0.0001).


```{r}
## #2 size differences in 2018 between MPA and non-MPA

MPA_2018 <- year_2018 %>% 
  filter(site_type == "MPA") %>% 
  pull(size_mm)

MPA_2012

non_MPA_2018 <- year_2018 %>% 
  filter(site_type == "Non-MPA") %>% 
  pull(size_mm)

size_2018_ttest <- t.test(MPA_2018, non_MPA_2018)

size_2018_ttest

#Cohen's d

size_2018_d <- effsize::cohen.d(MPA_2018, non_MPA_2018)

size_2018_d

mean_MPA_2018 <- mean(MPA_2018, na.rm = TRUE)
sd_MPA_2018 <- sd(MPA_2018, na.rm = TRUE)

mean_nonMPA_2018 <- mean(non_MPA_2018, na.rm = TRUE)
sd_nonMPA_2018 <- sd(non_MPA_2018, na.rm = TRUE)

```

Is there a significant difference in lobster size between MPA and non-MPA sites in 2018? 

Mean lobster size (mm) in MPA sites (`r round(mean_MPA_2018, 2)` $\pm$ `r round(sd_MPA_2018, 2)`, n = (inline referencing for n) differed significantly from the mean lobster size in non-MPA sites (`r round(mean_nonMPA_2018, 2)`) $\pm$ `r round(sd_nonMPA_2018, 2)`, n = (inline referencing!!) by using a two-sample t-test (t(`r round(size_2018_ttest$parameter, 2)`) = `r round(size_2018_ttest$statistic, 2)`, *p* <0.0001). (maybe inline reference p)


```{r}
## #3 size differences in MPA between 2012 and 2018

MPA_diff_ttest <- t.test(MPA_2012, MPA_2018)

MPA_diff_ttest

#Cohen's d

MPA_diff_d <- effsize::cohen.d(MPA_2012, MPA_2018)

MPA_diff_d

```

```{r}
## #4 size differences in non-MPA sites between 2012 and 2018

non_MPA_diff_ttest <- t.test(non_MPA_2012, non_MPA_2018)

non_MPA_diff_ttest

#Cohen's d

non_MPA_diff_d <- effsize::cohen.d(non_MPA_2012, non_MPA_2018)

non_MPA_diff_d

```

```{r}
### Interactive table

# Make table subset

sub_lobster <- lobster_tidy %>% 
  select(site, site_type, year, size_mm) %>% 
  filter(year == c("2012", "2018"))

summary_attempt <- tibble(mean_MPA_2012, mean_MPA_2018, mean_nonMPA_2012, mean_nonMPA_2018, sd_MPA_2012, sd_MPA_2018, sd_nonMPA_2012, sd_nonMPA_2018)




```


## References 

**Reed D. 2019.** *SBC LTER: Reef: Abundance, size and fishing effort for California Spiny Lobster (Panulirus interruptus), ongoing since 2012.* Environmental Data Initiative. https://doi.org/10.6073/pasta/a593a675d644fdefb736750b291579a0. Dataset accessed 11/15/2019.